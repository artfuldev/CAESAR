version: '{build}'
os: Visual Studio 2015
init:
 - cmd: set PATH=C:\Python34-x64;C:\Python34-x64\Scripts;%PATH%
install:
 - ps: Start-FileDownload https://raw.github.com/pypa/pip/master/contrib/get-pip.py
 - cmd: python get-pip.py
 - cmd: nuget sources add -Name api.nuget.org -Source https://api.nuget.org/v3/index.json
 - ps: "&{$Branch='dev';iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/aspnet/Home/dev/dnvminstall.ps1'))}"
 - ps: dnvm update-self
 - ps: dnvm upgrade
 - ps: dnvm install 1.0.0-rc1-update1
 - ps: dnvm list
 - ps: dnvm use 1.0.0-rc1-update1
before_build:
 - ps: dnu restore
build_script:
 - cmd: pip install codecov
test_script:
 - ps: cd .\CAESAR\CAESAR.Chess.Tests
 - ps: dnx test
 - ps: c:\users\appveyor\.dnx\packages\OpenCover\4.6.261-rc\OpenCover.Console.exe -target:"%PATH%\dnx.exe" -targetargs:"--lib C:\projects\caesar\CAESAR\CAESAR\artifacts\bin\CAESAR.Chess\Debug\dnxcore50\CAESAR.Chess.dll C:\projects\caesar\CAESAR\artifacts\bin\CAESAR.Chess\Debug\dnxcore50\CAESAR.Chess.Tests.dll test" -output:.\CAESAR.Chess_coverage.xml  -filter:+[CAESAR.Chess]*
 - cmd: codecov -f "CAESAR.Chess_coverage.xml"
 - ps: (New-Object System.Net.WebClient).DownloadFile("https://codecov.io/bash", ".\CodecovUploader.sh")
 - ps: .\CodecovUploader.sh -X gcov
